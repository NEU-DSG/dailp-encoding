query CollectionsListing {
  allCollections {
    name
    slug
  }
}

query DocumentsPages {
  allDocuments {
    id
    slug
    isReference
  }
}

# Data about a document needed to render various high level components, such as
# a DocumentHeader. Contrast with the fields resolved on DocumentContents query.
fragment DocumentFields on AnnotatedDoc {
  id
  title
  slug
  isReference
  date {
    year
  }
  bookmarkedOn {
    formattedDate
  }
  sources {
    name
    link
  }
  editedAudio {
    ...AudioSliceFields
    recordedBy {
      id
      displayName
    }
    recordedAt {
      formattedDate
    }
  }
  userContributedAudio {
    ...AudioSliceFields
    recordedBy {
      id
      displayName
    }
    recordedAt {
      formattedDate
    }
  }
  translatedPages {
    image {
      url
    }
  }
  chapters {
    id
    path
  }
}

query AnnotatedDocument($slug: String!) {
  document(slug: $slug) {
    ...DocumentFields
  }
}

query DocumentContents(
  $slug: String!
  $morphemeSystem: CherokeeOrthography!
  $isReference: Boolean!
) {
  document(slug: $slug) {
    id
    slug
    translatedPages @skip(if: $isReference) {
      pageNumber
      paragraphs {
        __typename
        source {
          __typename
          ... on AnnotatedForm {
            ...FormFields
          }
        }
        id
        translation
        index
        comments {
          id
        }
      }
    }
    forms @include(if: $isReference) {
      __typename
      ...FormFields
    }
  }
}

fragment AudioSliceFields on AudioSlice {
  sliceId
  index # if this is used as a caching key, we will have performance issues
  resourceUrl
  startTime
  endTime
  includeInEditedCollection
  recordedBy {
    displayName
  }
  recordedAt {
    formattedDate
  }
}

fragment DocFormFields on AnnotatedDoc {
  id
  title
  date {
    day
    month
    year
  }
  keywords {
    id
    name
    status
  }
  languages {
    id
    name
    status
  }
  subjectHeadings {
    id
    name
    status
  }
  spatialCoverage {
    id
    name
    status
  }
  creators {
    id
    name
  }
  contributors {
    id
    name
    role
  }
  format {
    id
    name
  }
  genre {
    id
    name
  }
}

fragment ParagraphFormFields on DocumentParagraph {
  __typename
  id
  index
  translation
  source {
    __typename
    ...FormFields
  }
  comments {
    id
  }
}

fragment CommentFormFields on Comment {
  id
  textContent
  commentType
  edited
}

fragment FormFields on AnnotatedForm {
  __typename
  id
  index
  source
  romanizedSource(system: $morphemeSystem)
  phonemic
  segments(system: $morphemeSystem) {
    morpheme
    gloss
    matchingTag {
      tag
      title
    }
    role
    previousSeparator
  }
  englishGloss
  commentary
  ingestedAudioTrack {
    ...AudioSliceFields
  }
  editedAudio {
    ...AudioSliceFields
    recordedBy {
      id
      displayName
    }
    recordedAt {
      formattedDate
    }
  }
  userContributedAudio {
    ...AudioSliceFields
    recordedBy {
      id
      displayName
    }
    recordedAt {
      formattedDate
    }
  }
  position {
    documentId
  }
  comments {
    id
  }
}

query Collection($slug: String!) {
  collection(slug: $slug) {
    name
    documents {
      id
      slug
      title
      date {
        year
      }
      orderIndex
    }
  }
}

query EditedCollections {
  allEditedCollections {
    id
    title
    slug
    description
    chapters {
      id
      path
    }
    thumbnailUrl
  }
}

query EditedCollection($slug: String!) {
  editedCollection(slug: $slug) {
    id
    title
    slug
    chapters {
      id
      title
      indexInParent
      section
      path
      slug
    }
  }
}

query WordSearch($query: String!) {
  wordSearch(query: $query) {
    source
    normalizedSource
    romanizedSource(system: LEARNER)
    englishGloss
    index
    document {
      id
      slug
      isReference
    }
  }
}

query AllSources {
  allDocuments {
    isReference
    id
    slug
    title
    date {
      year
    }
    contributors {
      name
    }
    formCount
  }
}

query Glossary($system: CherokeeOrthography!) {
  allTags(system: $system) {
    tag
    title
    definition
    morphemeType
  }
}

query Timeline($gloss: String!) {
  morphemeTimeClusters(gloss: $gloss, clusterYears: 50) {
    start {
      year
    }
    end {
      year
    }
    forms {
      source
      normalizedSource
      romanizedSource(system: LEARNER)
      phonemic
      documentId
      englishGloss
    }
  }
}

query DocumentDetails($slug: String!) {
  document(slug: $slug) {
    id
    slug
    title
    format {
      id
      name
      status
    }
    genre {
      id
      name
      status
    }
    date {
      day
      month
      year
    }
    contributors {
      id
      name
      role
    }
    sources {
      name
      link
    }
    keywords {
      id
      name
      status
    }
    languages {
      id
      name
      status
    }
    subjectHeadings {
      id
      name
      status
    }
    spatialCoverage {
      id
      name
      status
    }
    creators {
      id
      name
    }
  }
}

query EditablePage($id: String!) {
  page(id: $id) {
    id
    title
    body {
      __typename
      ... on Markdown {
        content
      }
    }
  }
}

query Tag($gloss: String!, $system: CherokeeOrthography!) {
  tag: morphemeTag(id: $gloss, system: $system) {
    morphemeType
    tag
    title
    definition
  }
}

query Morpheme($documentId: UUID, $morphemeGloss: String!) {
  documents: morphemesByDocument(
    documentId: $documentId
    morphemeGloss: $morphemeGloss
  ) {
    documentType
    forms {
      index
      source
      normalizedSource
      englishGloss
      document {
        id
        slug
      }
    }
  }
}

query UserInfo {
  userInfo {
    id
    email
    groups
  }
}

mutation NewPage($data: JSON!) {
  updatePage(data: $data)
}

query DocSlice(
  $slug: String!
  $start: Int!
  $end: Int
  $morphemeSystem: CherokeeOrthography!
) {
  document(slug: $slug) {
    title
    ingestedAudioTrack {
      resourceUrl
      startTime
      endTime
    }
    forms(start: $start, end: $end) {
      __typename
      ...FormFields
    }
  }
}

query CollectionChapter($collectionSlug: String!, $chapterSlug: String!) {
  chapter(collectionSlug: $collectionSlug, chapterSlug: $chapterSlug) {
    id
    title
    wordpressId
    slug
    breadcrumbs {
      name
      slug
    }
    document {
      ...DocumentFields
    }
  }
}

query BookmarkedDocuments {
  bookmarkedDocuments {
    ...DocumentFields
  }
}

fragment CommentFields on Comment {
  id
  postedAt {
    timestamp
    date {
      year
      month
      day
      formattedDate
    }
  }
  postedBy {
    id
    displayName
  }
  textContent
  edited
  commentType
}

query WordComments($wordId: UUID!) {
  wordById(id: $wordId) {
    id
    comments {
      ...CommentFields
    }
  }
}

query ParagraphComments($paragraphId: UUID!) {
  paragraphById(id: $paragraphId) {
    id
    comments {
      ...CommentFields
    }
  }
}

mutation UpdateWord(
  $word: AnnotatedFormUpdate!
  $morphemeSystem: CherokeeOrthography!
) {
  updateWord(word: $word) {
    ...FormFields
  }
}

mutation AttachAudioToWord($input: AttachAudioToWordInput!) {
  attachAudioToWord(input: $input) {
    # ...FormFields
    id
    userContributedAudio {
      ...AudioSliceFields
      recordedBy {
        id
        displayName
      }
    }
  }
}

mutation CurateDocumentAudio($input: CurateDocumentAudioInput!) {
  curateDocumentAudio(input: $input) {
    id
    editedAudio {
      ...AudioSliceFields
    }
  }
}

mutation CurateWordAudio($input: CurateWordAudioInput!) {
  curateWordAudio(input: $input) {
    # ...FormFields
    id
    userContributedAudio {
      ...AudioSliceFields
      recordedBy {
        id
        displayName
      }
    }
  }
}

mutation AttachAudioToDocument($input: AttachAudioToDocumentInput!) {
  attachAudioToDocument(input: $input) {
    id
    title
    slug
    userContributedAudio {
      ...AudioSliceFields
      recordedAt {
        formattedDate
      }
      recordedBy {
        id
        displayName
      }
    }
  }
}

fragment BookmarkedDocument on AnnotatedDoc {
  id
  title
  slug
  bookmarkedOn {
    formattedDate
  }
}

mutation AddBookmark($documentId: UUID!) {
  addBookmark(documentId: $documentId) {
    ...BookmarkedDocument
  }
}

mutation RemoveBookmark($documentId: UUID!) {
  removeBookmark(documentId: $documentId) {
    ...BookmarkedDocument
  }
}

mutation UpdateParagraph($paragraph: ParagraphUpdate!) {
  updateParagraph(paragraph: $paragraph) {
    id
    translation
  }
}

mutation UpdateContributorAttribution(
  $contribution: UpdateContributorAttribution!
) {
  updateContributorAttribution(contribution: $contribution)
}

mutation DeleteContributorAttribution(
  $contribution: DeleteContributorAttribution!
) {
  deleteContributorAttribution(contribution: $contribution)
}

mutation UpdateDocumentMetadata($document: DocumentMetadataUpdate!) {
  updateDocumentMetadata(document: $document)
}

mutation UpdateComment($comment: CommentUpdate!) {
  updateComment(comment: $comment) {
    ... on AnnotatedForm {
      __typename
      id
      comments {
        ...CommentFields
      }
    }
    ... on DocumentParagraph {
      __typename
      id
      comments {
        ...CommentFields
      }
    }
  }
}

mutation PostComment($input: PostCommentInput!) {
  postComment(input: $input) {
    ... on AnnotatedForm {
      __typename
      id
      comments {
        ...CommentFields
      }
    }
    ... on DocumentParagraph {
      __typename
      id
      comments {
        ...CommentFields
      }
    }
  }
}

mutation DeleteComment($commentId: DeleteCommentInput!) {
  deleteComment(input: $commentId) {
    ... on AnnotatedForm {
      __typename
      id
      comments {
        ...CommentFields
      }
    }
    ... on DocumentParagraph {
      __typename
      id
      comments {
        ...CommentFields
      }
    }
  }
}

mutation AddDocument($input: CreateDocumentFromFormInput!) {
  addDocument(input: $input) {
    id
    title
    slug
    collectionSlug
    chapterSlug
  }
}

mutation AddEditedCollection($input: CreateEditedCollectionInput!) {
  createEditedCollection(input: $input)
}

mutation updateUser($user: UserUpdate!) {
  updateUser(user: $user) {
    id
    displayName
    avatarUrl
    bio
    organization
    location
    role
  }
}

query UserById($id: UUID!) {
  dailpUserById(id: $id) {
    id
    displayName
    createdAt {
      day
      month
      year
    }
    avatarUrl
    bio
    organization
    location
    role
  }
}

query AllCollections {
  allCollections {
    name
    slug
    id
  }
}

mutation InsertCustomMorphemeTag(
  $tag: String!
  $title: String!
  $system: String!
) {
  insertCustomMorphemeTag(tag: $tag, title: $title, system: $system)
}

mutation UpsertPage($pageInput: NewPageInput!) {
  upsertPage(page: $pageInput)
}

query AllPages {
  allPages {
    path
  }
}

query pageByPath($path: String!) {
  pageByPath(path: $path) {
    title
    body {
      __typename
      ... on Markdown {
        content
      }
      ... on Gallery {
        mediaUrls
      }
    }
  }
}

query MenuBySlug($slug: String!) {
  menuBySlug(slug: $slug) {
    id
    name
    slug
    items {
      label
      path
      items {
        label
        path
      }
    }
  }
}

mutation UpdateMenu($menu: MenuUpdate!) {
  updateMenu(menu: $menu) {
    id
    name
    slug
    items {
      label
      path
      items {
        label
        path
      }
    }
  }
}
