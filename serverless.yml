service: dailp
useDotenv: true
plugins:
  - serverless-rust
provider:
  name: aws
  region: us-east-1
  runtime: rust
  memorySize: 512
  timeout: 30
  apiGateway:
    shouldStartNameWithService: true
  environment:
    MONGODB_URI: ${env:MONGODB_URI}
    MONGODB_PASSWORD: ${env:MONGODB_PASSWORD}
  vpc:
    securityGroupIds:
      - sg-09a273617c1be0577
    subnetIds:
      - subnet-0a39453d94ed889d6
      - subnet-08452f5a8b4ff8085
      - subnet-05944b39f6c30b57e
      - subnet-0c5c9bca12e771cab
custom:
  rust:
    dockerless: true
package:
  individually: true
functions:
  dailp-graphql:
    handler: dailp-graphql
    events:
      - http:
          path: "/graphql"
          method: any
          cors:
            origin: "*"
            headers:
              - Content-Type
              - X-Amz-Date
              - Authorization
              - X-Api-Key
              - X-Amz-Security-Token
              - X-Amz-User-Agent
              - x-apollo-tracing
            allowCredentials: false
    package:
      include:
        - aws-certificate.pem
# resources:
#   Resources:
#     DBCluster:
#       Type: "AWS::DocDB::DBCluster"
#       DeletionPolicy: Delete
#       Properties:
#         DBClusterIdentifier: "dailp-prod"
#         MasterUsername: ${env:MONGODB_USERNAME}
#         MasterUserPassword: ${env:MONGODB_PASSWORD}

#     DBInstance:
#       Type: "AWS::DocDB::DBInstance"
#       Properties:
#         DBClusterIdentifier: "dailp-prod"
#         DBInstanceIdentifier: "dailp-prod-1"
#         DBInstanceClass: "db.t3.medium"
#       DependsOn: DBCluster
