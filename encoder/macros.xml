
{% macro word(segment) %}
  <w xml:id="textID.w{{segment.index + 1}}" lemmaRef="lex:id">
    <choice>
      <orig>{{segment.source}}</orig>
      <reg>{{segment.source}}</reg>
      {% if segment.simple_phonetics %}
        <seg type="simple_phonetics">{{segment.simple_phonetics}}</seg>
      {% endif %}
      {% if segment.morphemic_segmentation %}
        <seg type="morphemic_segmentation">{{segment.morphemic_segmentation}}</seg>
      {% endif %}
      {% if segment.english_gloss %}
        <seg type="gloss">{{segment.english_gloss}}</seg>
      {% endif %}
    </choice>
  </w>
{% endmacro word %}

{% macro phrase(segment) %}
  <seg type="idea_unit" xml:id="s{{segment.index + 1}}" corresp="#s{{segment.index + 1}}_trans">
    {% for child in segment.parts %}
      {{ self::any_segment(segment=child) }}
    {% endfor %}
  </seg>
{% endmacro phrase %}

{% macro any_segment(segment) %}
  {% if segment.type == "LineBreak" %}
    <lb n="{{segment.index + 1}}"/>
  {% elif segment.type == "Phrase" %}
    {{ self::phrase(segment=segment) }}
  {% elif segment.type == "Word" %}
    {{ self::word(segment=segment)  }}
  {% endif %}
{% endmacro any_segment %}
